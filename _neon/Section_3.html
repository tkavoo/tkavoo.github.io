
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3: Soil Water Content &#8212; NEON Tutorial for Data download and processing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Section_3';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4: Soil Temperature" href="Section_4.html" />
    <link rel="prev" title="2. NEON Utilities Tools" href="Section_2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/cws.png" class="logo__image only-light" alt="NEON Tutorial for Data download and processing - Home"/>
    <script>document.write(`<img src="_static/cws.png" class="logo__image only-dark" alt="NEON Tutorial for Data download and processing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Exploring NEON Data Tutorial
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Prerequisite.html">1: Importing Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_2.html">2. NEON Utilities Tools</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">3: Soil Water Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_4.html">4: Soil Temperature</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_5.html">5: Soil Carbon Dioxide (CO2)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FSection_3.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Section_3.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>3: Soil Water Content</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-soil-moisture-data">3.1 Understanding Soil Moisture Data:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-sensor-positions-if-necessary">3.2 Downloading Sensor Positions (if necessary):</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloaded-files-and-loading-data">3.3 Downloaded Files and Loading Data:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-soil-depth-column">3.4 Adding Soil Depth Column</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-mesh-and-2d-array">3.5 Creating a Mesh and 2D Array</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-soil-moisture-profile">3.6 Visualizing Soil Moisture Profile</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="soil-water-content">
<h1>3: Soil Water Content<a class="headerlink" href="#soil-water-content" title="Link to this heading">#</a></h1>
<p>This section provides instructions to analyzing soil volumetric water content (SWC) data downloaded from NEON using <code class="docutils literal notranslate"><span class="pre">neonUtilities</span></code>. Generally, Soil volumetric water content is recorded at various depths below the soil surface from 6 cm down to 200 cm at non-permafrost sites (down to 300 cm at Alaskan sites).</p>
<section id="understanding-soil-moisture-data">
<h2>3.1 Understanding Soil Moisture Data:<a class="headerlink" href="#understanding-soil-moisture-data" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>NEON records SWC data at various depths (typically 6 cm to 200 cm) for non-permafrost sites.</p></li>
<li><p>Data comes from five instrumented plots per site, with 1-minute and 30-minute averages.</p></li>
<li><p>Due to ongoing data product corrections, sensor position data is provided in a separate file (swc_depthsV2.csv) within the downloaded package.</p></li>
</ul>
</section>
<section id="downloading-sensor-positions-if-necessary">
<h2>3.2 Downloading Sensor Positions (if necessary):<a class="headerlink" href="#downloading-sensor-positions-if-necessary" title="Link to this heading">#</a></h2>
<p>The code snippet demonstrates how to download the swc_depthsV2.csv file using requests if it’s not automatically included.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://data.neonscience.org/documents/10179/11206/swc_depthsV2/77eee1a6-4de5-6746-4471-ab3a61c7685b&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
    <span class="n">sensor_p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sensor position data loaded successfully.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to download the sensor position file.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sensor position data loaded successfully.
</pre></div>
</div>
</div>
</div>
</section>
<section id="downloaded-files-and-loading-data">
<h2>3.3 Downloaded Files and Loading Data:<a class="headerlink" href="#downloaded-files-and-loading-data" title="Link to this heading">#</a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">os.listdir('saved/path')</span></code> to verify downloaded files in the specified path.
We’ll work with the 30-minute data (SWS_30_minute.csv) for demonstration.
The code loads the data into a pandas DataFrame (SWS_30_Minute), converts the startDateTime to datetime format, and sets it as the index.</p>
<ul class="simple">
<li><p>Loading Soil Volumetric Water Content Data
We start by loading the soil VWC data, focusing on 30-minute intervals for demonstration purposes.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;filesToStack00094/stackedFiles/SWS_30_minute.csv&#39;</span>
<span class="n">soil_vwc_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">soil_vwc_data</span><span class="p">[</span><span class="s1">&#39;startDateTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">soil_vwc_data</span><span class="p">[</span><span class="s1">&#39;startDateTime&#39;</span><span class="p">])</span>
<span class="n">soil_vwc_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;startDateTime&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Data Organization and Cleaning</strong></p>
<ul class="simple">
<li><p>We’ll focus on plot 1 (horizontalPosition == 1) at the TALL site (siteID == ‘TALL’).</p></li>
<li><p>Select relevant columns from the DataFrame (columns_of_interest).</p></li>
<li><p>Filter the data for plot 1 and remove rows with poor data quality (VSICFinalQF != 0).</p></li>
<li><p>Group the data by date and vertical position, calculating:</p>
<ul>
<li><p>Mean for VSWCMean, VSICMean</p></li>
<li><p>Mean for minimum and maximum values of VSWCMinimum, VSWCMaximum, VSICMinimum, VSICMaximum</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_of_interest</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;domainID&#39;</span><span class="p">,</span> <span class="s1">&#39;siteID&#39;</span><span class="p">,</span> <span class="s1">&#39;horizontalPosition&#39;</span><span class="p">,</span> <span class="s1">&#39;verticalPosition&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;VSWCMean&#39;</span><span class="p">,</span> <span class="s1">&#39;VSWCMinimum&#39;</span><span class="p">,</span> <span class="s1">&#39;VSWCMaximum&#39;</span><span class="p">,</span> <span class="s1">&#39;VSWCFinalQF&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;VSICMean&#39;</span><span class="p">,</span> <span class="s1">&#39;VSICMinimum&#39;</span><span class="p">,</span> <span class="s1">&#39;VSICMaximum&#39;</span><span class="p">,</span> <span class="s1">&#39;VSICFinalQF&#39;</span><span class="p">]</span>
<span class="n">sw_df</span> <span class="o">=</span> <span class="n">soil_vwc_data</span><span class="p">[</span><span class="n">columns_of_interest</span><span class="p">]</span>
<span class="c1">#Activate the line below if only interested in a specific plot</span>
<span class="c1">#df = sw_df[(sw_df[&#39;horizontalPosition&#39;] == 1) &amp; (sw_df[&#39;VSICFinalQF&#39;] == 0)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">sw_df</span><span class="p">[(</span><span class="n">sw_df</span><span class="p">[</span><span class="s1">&#39;VSICFinalQF&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
<span class="n">daily_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;verticalPosition&#39;</span><span class="p">,</span> <span class="s1">&#39;horizontalPosition&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;domainID&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;siteID&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span>
     <span class="s1">&#39;VSWCMean&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;VSWCMinimum&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;VSWCMaximum&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
     <span class="s1">&#39;VSICMean&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;VSICMinimum&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;VSICMaximum&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">daily_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Rename level_0 to Date</span>
<span class="n">daily_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span> <span class="s1">&#39;Date&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Set Date column as index</span>
<span class="n">daily_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="adding-soil-depth-column">
<h2>3.4 Adding Soil Depth Column<a class="headerlink" href="#adding-soil-depth-column" title="Link to this heading">#</a></h2>
<p>We’ll use the downloaded sensor position data <code class="docutils literal notranslate"><span class="pre">(sensor_p)</span></code> to add a <code class="docutils literal notranslate"><span class="pre">soilDepth</span></code> column</p>
<ul class="simple">
<li><p>Filter the sensor depth data <code class="docutils literal notranslate"><span class="pre">(sensor_p)</span></code> for the TALL site <code class="docutils literal notranslate"><span class="pre">(siteID.startswith('TAL'))</span></code>.</p></li>
<li><p>Create a dictionary <code class="docutils literal notranslate"><span class="pre">sensor_depth_map</span></code> to map sensor depths based on vertical positions.</p></li>
<li><p>Define a function <code class="docutils literal notranslate"><span class="pre">populate_soil_depth</span></code> to assign soil depth values based on vertical positions in a new DataFrame <code class="docutils literal notranslate"><span class="pre">(plot_1)</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selecting soil depth for TALL site only</span>
<span class="n">sensor_p</span> <span class="o">=</span> <span class="n">sensor_p</span><span class="p">[</span><span class="n">sensor_p</span><span class="p">[</span><span class="s1">&#39;siteID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TAL&#39;</span><span class="p">)]</span>
<span class="c1"># Creating a new DataFrame to store the result</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">daily_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Creating a dictionary to map sensor depth values based on horizontal and vertical positions</span>
<span class="n">sensor_depth_map</span> <span class="o">=</span> <span class="p">{(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;verticalPosition.VER&#39;</span><span class="p">]):</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;sensorDepth&#39;</span><span class="p">]</span> 
                    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sensor_p</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()}</span>

<span class="c1"># Function to populate soilDepth column</span>
<span class="k">def</span> <span class="nf">populate_soil_depth</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">vertical_pos</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;verticalPosition&#39;</span><span class="p">]</span>
    <span class="n">sensor_depth</span> <span class="o">=</span> <span class="n">sensor_depth_map</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">vertical_pos</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sensor_depth</span>

<span class="c1"># Applying the function to populate soilDepth column</span>
<span class="n">plot</span><span class="p">[</span><span class="s1">&#39;soilDepth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">populate_soil_depth</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;soilDepth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(8, 683) (8, 683)
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-a-mesh-and-2d-array">
<h2>3.5 Creating a Mesh and 2D Array<a class="headerlink" href="#creating-a-mesh-and-2d-array" title="Link to this heading">#</a></h2>
<p>The code first iterates over unique depth values and unique dates. This allows us to create groups based on the combination of depth and date. The code then filters the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to retrieve data corresponding to that <code class="docutils literal notranslate"><span class="pre">depth</span></code>.</p>
<p>Since we are computing the average soil water content for all the five plots, then we need to compute the mean. For each combination of depth and date, the code retrieves the VSWCMean values. If there are multiple values (indicating multiple plots), it calculates the mean of these values. This ensures that you’re aggregating the soil water content values across all plots for a given depth and date.</p>
<p>The mean value calculated for each <code class="docutils literal notranslate"><span class="pre">depth-date</span></code> combination is stored in the <code class="docutils literal notranslate"><span class="pre">plot_var</span></code> array. This array will contain the mean soil water content values for the entire area, organized by depth and date.</p>
<p>By aggregating the values in this manner, you’re effectively creating a representation of the mean soil water content for the <code class="docutils literal notranslate"><span class="pre">entire</span> <span class="pre">area</span></code>, rather than <code class="docutils literal notranslate"><span class="pre">individual</span> <span class="pre">plots</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Get unique depth values</span>
<span class="n">depth_values</span> <span class="o">=</span> <span class="n">plot</span><span class="p">[</span><span class="s1">&#39;soilDepth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># Get unique dates</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># Initialize 2D array to store VSWCMean values</span>
<span class="n">plot_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">depth_values</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)))</span>

<span class="c1"># Iterate over unique depth values</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">depth_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">depth_values</span><span class="p">):</span>
    <span class="c1"># Filter DataFrame for the current depth value</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">plot</span><span class="p">[</span><span class="n">plot</span><span class="p">[</span><span class="s1">&#39;soilDepth&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">depth_value</span><span class="p">]</span>
    <span class="c1"># Iterate over unique dates</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dates</span><span class="p">):</span>
        <span class="c1"># Check if the date exists in the DataFrame</span>
        <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="c1"># Get VSWCMean values for the current depth value and date</span>
            <span class="n">vswc_values</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;VSWCMean&#39;</span><span class="p">]</span>
            <span class="c1"># Calculate the mean of VSWCMean values</span>
            <span class="n">vswc_mean</span> <span class="o">=</span> <span class="n">vswc_values</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vswc_values</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="k">else</span> <span class="n">vswc_values</span>
            <span class="c1"># Store VSWCMean mean value in 2D array</span>
            <span class="n">plot_var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">vswc_mean</span>

<span class="nb">print</span><span class="p">(</span><span class="n">plot_var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(8, 683)
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-soil-moisture-profile">
<h2>3.6 Visualizing Soil Moisture Profile<a class="headerlink" href="#visualizing-soil-moisture-profile" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Use the filled plot_var array to create a contour plot using matplotlib.</p></li>
<li><p>The x-axis represents dates, and the y-axis represents soil depth.</p></li>
<li><p>The color intensity reflects SWC values (higher intensity indicates higher moisture).</p></li>
<li><p>Customize the plot with labels, title, colorbar, and axis rotation for better readability.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="k">def</span> <span class="nf">truncate_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">new_cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="s1">&#39;trunc(</span><span class="si">{n}</span><span class="s1">,</span><span class="si">{a:.2f}</span><span class="s1">,</span><span class="si">{b:.2f}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">minval</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">maxval</span><span class="p">),</span>
        <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">new_cmap</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gist_earth_r&#39;</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelweight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span>
<span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">font</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">plot_var</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Soil Depth [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Period&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span> <span class="p">(</span><span class="s1">&#39;Time-Series of Soil Moisture Profile at TALL&#39;</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;Soil Water Content (m³/m³)&#39;</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/759c38d43d403f75c780eebcdc4883b36f3be99b56e95218723869a69dd1d619.png" src="_images/759c38d43d403f75c780eebcdc4883b36f3be99b56e95218723869a69dd1d619.png" />
</div>
</div>
<p>This section demonstrated the process of downloading, cleaning, and visualizing NEON soil moisture data to create a time-series plot of soil moisture profiles. You can adapt this approach to analyze data from other plots, depths, and time periods.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Section_2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">2. NEON Utilities Tools</p>
      </div>
    </a>
    <a class="right-next"
       href="Section_4.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">4: Soil Temperature</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-soil-moisture-data">3.1 Understanding Soil Moisture Data:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-sensor-positions-if-necessary">3.2 Downloading Sensor Positions (if necessary):</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloaded-files-and-loading-data">3.3 Downloaded Files and Loading Data:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-soil-depth-column">3.4 Adding Soil Depth Column</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-mesh-and-2d-array">3.5 Creating a Mesh and 2D Array</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-soil-moisture-profile">3.6 Visualizing Soil Moisture Profile</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Kavoo and Sanjiv Kumar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>